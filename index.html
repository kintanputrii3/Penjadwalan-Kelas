<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Info D</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cherry+Bomb+One&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Igari Color Palette & Theme */
        :root {
            --bg-light: #FDF9F3; /* Soft cream/off-white */
            --bg-medium: #F3EFE9; /* Slightly darker cream */
            --text-dark: #3F3F3F; /* Dark grey for text */
            --accent-pink: #FFC0CB; /* Soft pink */
            --accent-green: #A2D9CE; /* Soft mint green */
            --accent-red: #E65A5A; /* Muted red */
            --border-color: #E0DED7; /* Light subtle border */
        }
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-dark);
            transition: background-image 0.5s ease-in-out;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        h1, h2, h3, h4 {
            font-family: 'Cherry Bomb One', cursive; /* Playful, bold font for titles */
            color: var(--accent-red);
        }
        .bg-blur {
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        .scroll-container {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .scroll-container::-webkit-scrollbar {
            display: none;
        }
        .card {
            background-color: rgba(255, 255, 255, 0.85); /* White with opacity */
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            backdrop-filter: blur(8px); /* More blur for a softer look */
            -webkit-backdrop-filter: blur(8px);
        }
        .btn-primary { /* User-focused / main actions */
            background-color: var(--accent-pink);
            color: var(--text-dark);
            border: 1px solid var(--accent-pink);
        }
        .btn-primary:hover {
            background-color: #FFB3C0; /* Slightly darker pink */
        }
        .btn-secondary { /* Admin-focused / secondary actions */
             background-color: var(--accent-green);
             color: var(--text-dark);
             border: 1px solid var(--accent-green);
        }
        .btn-secondary:hover {
            background-color: #8FD1C2; /* Slightly darker green */
        }
        .input-field {
            background-color: var(--bg-medium);
            border: 1px solid var(--border-color);
            color: var(--text-dark);
        }
        .input-field::placeholder {
            color: #888;
        }
        .input-field:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--accent-pink); /* Pink focus for user, maybe green for admin */
        }
        /* Specific input field focus for admin */
        #admin-login-section .input-field:focus,
        #admin-dashboard .input-field:focus {
             box-shadow: 0 0 0 2px var(--accent-green);
        }

        .text-accent {
            color: var(--accent-red); /* Muted red for primary accents */
        }
        .text-accent-light {
             color: var(--accent-pink); /* Pink for lighter accents */
        }
        .border-accent {
            border-color: var(--accent-pink);
        }
         .border-accent-light {
            border-color: var(--accent-green);
        }
        .logout-btn {
            background-color: var(--accent-red);
            color: var(--white);
            border: 1px solid var(--accent-red);
        }
        .logout-btn:hover {
            background-color: #D14B4B; /* Darker red */
        }

        /* Specific backgrounds for login/dashboard */
        .login-bg {
            background-image: url('https://images.unsplash.com/photo-1587393855524-087f83d95bc9?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w1MDcxMzJ8MHwxfHNlYXJjaHwxfHxzdHJhd2JlcnJ5JTIwYmFja2dyb3VuZHxlbnwwfHx8fDE3MDc5NTExNTJ8MA&ixlib=rb-4.0.3&q=80&w=1080'); /* Strawberry background */
        }
        .dashboard-bg {
            background-image: url('https://images.unsplash.com/photo-1563805042-76E04845e009?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w1MDcxMzJ8MHwxfHNlYXJjaHwxfHxjaGVlc2VjYWtlJTIwYmFja2dyb3VuZHxlbnwwfHx8fDE3MDc5NTExNzd8MA&ixlib=rb-4.0.3&q=80&w=1080'); /* Cheesecake background */
        }
    </style>
</head>
<body class="text-dark selection:bg-accent-pink selection:text-white">

    <div id="app" class="min-h-screen flex items-center justify-center p-4">

        <!-- Tampilan Awal: Pilih Peran -->
        <div id="initial-view" class="w-full max-w-md">
            <div class="card bg-blur p-8 rounded-2xl shadow-2xl text-center">
                <!-- Logo Buku -->
                <svg class="w-16 h-16 mx-auto mb-2 text-accent-red" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18c-2.305 0-4.408.867-6 2.292m0-14.25v14.25" />
                </svg>
                <h1 class="text-4xl font-bold text-accent-red mb-2">Class Info D</h1>
                 <p class="text-text-dark mt-2 mb-8">Halo, selamat datang!</p>
                <div class="space-y-4">
                    <button onclick="showLoginView('user')" class="w-full btn-primary font-bold py-3 px-4 rounded-lg transition duration-300 shadow-lg text-lg">Masuk sebagai Murid</button>
                    <button onclick="showLoginView('admin')" class="w-full btn-secondary font-bold py-3 px-4 rounded-lg transition duration-300 shadow-lg text-lg">Masuk sebagai Pengelola</button>
                </div>
            </div>
        </div>

        <!-- Login Pengguna -->
        <div id="user-login-section" class="hidden w-full max-w-md">
            <div class="card bg-blur p-8 rounded-2xl shadow-2xl">
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-bold text-accent-red">Selamat Datang!</h1>
                    <p class="text-text-dark mt-2">Masuk untuk melihat jadwalmu.</p>
                </div>
                <form id="user-login-form">
                    <div class="mb-4">
                        <label for="user-username" class="block mb-2 text-sm font-medium text-text-dark">Nama Panggilan</label>
                        <input type="text" id="user-username" class="w-full input-field rounded-lg px-4 py-2 transition duration-200" required>
                    </div>
                    <div class="mb-6">
                        <label for="user-password" class="block mb-2 text-sm font-medium text-text-dark">Kata Sandi</label>
                        <input type="password" id="user-password" class="w-full input-field rounded-lg px-4 py-2 transition duration-200" required>
                    </div>
                     <p id="user-login-error" class="text-red-500 text-sm mb-4 text-center hidden"></p>
                    <button type="submit" class="w-full btn-primary font-bold py-2 px-4 rounded-lg transition duration-300 shadow-lg">Masuk</button>
                    <button type="button" onclick="showInitialView()" class="w-full text-center text-text-dark hover:text-accent-red mt-4 text-sm">Kembali</button>
                </form>
            </div>
        </div>
        
        <!-- Login Admin -->
        <div id="admin-login-section" class="hidden w-full max-w-md">
            <div class="card bg-blur p-8 rounded-2xl shadow-2xl">
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-bold text-accent-red">Area Pengelola</h1>
                    <p class="text-text-dark mt-2">Atur jadwal dan notifikasi.</p>
                </div>
                <form id="admin-login-form">
                    <div class="mb-4">
                        <label for="admin-username" class="block mb-2 text-sm font-medium text-text-dark">Nama Pengelola</label>
                        <input type="text" id="admin-username" value="admin" class="w-full input-field rounded-lg px-4 py-2 transition duration-200" required>
                    </div>
                    <div class="mb-6">
                        <label for="admin-password" class="block mb-2 text-sm font-medium text-text-dark">Kata Sandi</label>
                        <input type="password" id="admin-password" class="w-full input-field rounded-lg px-4 py-2 transition duration-200" required>
                    </div>
                     <p id="admin-login-error" class="text-red-500 text-sm mb-4 text-center hidden"></p>
                    <button type="submit" class="w-full btn-secondary font-bold py-2 px-4 rounded-lg transition duration-300 shadow-lg">Masuk</button>
                    <button type="button" onclick="showInitialView()" class="w-full text-center text-text-dark hover:text-accent-red mt-4 text-sm">Kembali</button>
                </form>
            </div>
        </div>

        <!-- Dasbor Pengguna -->
        <div id="user-dashboard" class="hidden w-full max-w-7xl">
            <!-- Header Pengguna -->
            <div class="card bg-blur p-6 rounded-2xl shadow-2xl mb-6 flex justify-between items-center">
                <div>
                    <h2 class="text-3xl font-bold text-accent-red">Dasbor Murid</h2>
                    <p id="user-welcome" class="text-text-dark"></p>
                </div>
                <button id="user-logout-btn" class="logout-btn font-bold py-2 px-4 rounded-lg transition duration-300">Keluar</button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Notifikasi Pengguna -->
                <div class="lg:col-span-1">
                    <div class="card bg-blur p-6 rounded-2xl shadow-2xl h-full">
                        <h3 class="text-2xl font-bold mb-4 text-accent-red">Pengumuman Terbaru</h3>
                        <div id="user-notifications" class="space-y-3 max-h-[150px] overflow-y-auto scroll-container">
                            <!-- Notifikasi akan di-render di sini -->
                        </div>
                    </div>
                </div>
                 <!-- Jadwal Piket Pengguna -->
                <div class="lg:col-span-1">
                    <div class="card bg-blur p-6 rounded-2xl shadow-2xl h-full">
                        <h3 class="text-2xl font-bold mb-4 text-accent-red">Jadwal Piketku</h3>
                        <div id="user-picket-schedule">
                            <!-- Jadwal piket akan di-render di sini -->
                        </div>
                    </div>
                </div>
                
                <!-- Jadwal Pelajaran (Penuh) -->
                <div class="lg:col-span-3">
                    <div class="card bg-blur p-6 rounded-2xl shadow-2xl">
                        <h3 class="text-2xl font-bold mb-4 text-accent-red">Jadwal Pelajaran Lengkap</h3>
                        <div id="user-class-schedule" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                            <!-- Jadwal pelajaran akan di-render di sini -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dasbor Admin -->
        <div id="admin-dashboard" class="hidden w-full max-w-7xl">
             <!-- Header Admin -->
            <div class="card bg-blur p-6 rounded-2xl shadow-2xl mb-6 flex justify-between items-center">
                <div>
                    <h2 class="text-3xl font-bold text-accent-red">Dasbor Pengelola</h2>
                    <p class="text-text-dark">Selamat datang, Pengelola!</p>
                </div>
                <button id="admin-logout-btn" class="logout-btn font-bold py-2 px-4 rounded-lg transition duration-300">Keluar</button>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Kelola Jadwal Pelajaran -->
                <div>
                    <div class="card bg-blur p-6 rounded-2xl shadow-2xl">
                        <h3 class="text-2xl font-bold mb-4 text-accent-red">Kelola Jadwal Pelajaran</h3>
                        <div id="admin-class-schedule-list" class="space-y-4 max-h-[300px] overflow-y-auto scroll-container pr-2">
                           <!-- Daftar jadwal pelajaran admin -->
                        </div>
                         <div class="mt-4">
                            <h4 class="font-semibold mb-2 text-lg text-text-dark">Tambah Pelajaran Baru</h4>
                            <form id="add-lesson-form" class="grid grid-cols-1 sm:grid-cols-3 gap-2">
                                <select id="add-lesson-day" class="input-field rounded-lg px-3 py-2 text-text-dark">
                                    <option>Senin</option><option>Selasa</option><option>Rabu</option><option>Kamis</option><option>Jumat</option>
                                </select>
                                <input type="text" id="add-lesson-name" placeholder="Nama Pelajaran" class="input-field rounded-lg px-3 py-2 text-text-dark" required>
                                <input type="text" id="add-lesson-time" placeholder="00.00-00.00" class="input-field rounded-lg px-3 py-2 text-text-dark" required>
                                <button type="submit" class="sm:col-span-3 w-full btn-secondary font-bold py-2 rounded-lg transition duration-300 mt-2">Tambah</button>
                            </form>
                        </div>
                    </div>
                </div>
                
                 <!-- Kelola Jadwal Piket -->
                <div>
                    <div class="card bg-blur p-6 rounded-2xl shadow-2xl">
                        <h3 class="text-2xl font-bold mb-4 text-accent-red">Kelola Jadwal Piket</h3>
                        <div id="admin-picket-schedule-list" class="space-y-4 max-h-[300px] overflow-y-auto scroll-container pr-2">
                           <!-- Daftar piket admin -->
                        </div>
                        <div class="mt-4">
                            <h4 class="font-semibold mb-2 text-lg text-text-dark">Tambah Anggota Piket</h4>
                            <form id="add-picket-form" class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                <select id="add-picket-day" class="input-field rounded-lg px-3 py-2 text-text-dark">
                                    <option>Senin</option><option>Selasa</option><option>Rabu</option><option>Kamis</option><option>Jumat</option>
                                </select>
                                <input type="text" id="add-picket-name" placeholder="Nama Murid" class="input-field rounded-lg px-3 py-2 text-text-dark" required>
                                <button type="submit" class="sm:col-span-2 w-full btn-secondary font-bold py-2 rounded-lg transition duration-300 mt-2">Tambah</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Kelola Notifikasi -->
                <div class="lg:col-span-2">
                    <div class="card bg-blur p-6 rounded-2xl shadow-2xl">
                        <h3 class="text-2xl font-bold mb-4 text-accent-red">Kirim Pengumuman</h3>
                        <form id="send-notification-form">
                            <div class="mb-4">
                                <label for="notification-target" class="block mb-2 text-sm font-medium text-text-dark">Kirim Ke</label>
                                <select id="notification-target" class="w-full input-field rounded-lg px-4 py-2 text-text-dark">
                                    <option value="all">Semua Murid</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label for="notification-message" class="block mb-2 text-sm font-medium text-text-dark">Pesan</label>
                                <textarea id="notification-message" rows="3" class="w-full input-field rounded-lg px-4 py-2 text-text-dark" required></textarea>
                            </div>
                            <button type="submit" class="w-full btn-primary font-bold py-2 rounded-lg transition duration-300">Kirim</button>
                        </form>
                        <div class="mt-6">
                            <h4 class="text-xl font-semibold mb-3 text-text-dark">Riwayat Pengumuman</h4>
                            <div id="notification-history" class="space-y-2 max-h-[150px] overflow-y-auto scroll-container pr-2">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    
    <script>
        // --- DATABASE (SIMULATED) ---
        let users = {
            'Nabil': 'user123', 'Malia': 'user123', 'Sultan': 'user123', 'Nasya': 'user123',
            'Naya': 'user123', 'Hasna': 'user123', 'Kintan': 'user123', 'Nadia': 'user123',
            'Farhan': 'user123', 'Chairil': 'user123', 'Syakilla': 'user123', 'Zahra': 'user123',
            'Aldebaran': 'user123', 'Aulia': 'user123', 'Heni': 'user123', 'Luna': 'user123',
            'Resti': 'user123', 'Denian': 'user123', 'Raka': 'user123', 'Syafira': 'user123',
            'Fajri': 'user123', 'Ridhan': 'user123', 'Naisya': 'user123', 'Puspita': 'user123',
            'Rizqy': 'user123', 'Maya': 'user123', 'Anzilah': 'user123', 'Ghaisan': 'user123',
            'Rafa': 'user123', 'Putri': 'user123', 'Fadhillah': 'user123', 'Syifa': 'user123',
            'Daiva': 'user123', 'Keisha': 'user123', 'Ayya': 'user123', 'Iyan': 'user123'
        };
        
        let classSchedule = {
            Senin: [
                { id: 1, subject: 'Bahasa Indonesia', time: '07.15-09.30' },
                { id: 2, subject: 'Informatika', time: '09.45-12.00' },
                { id: 3, subject: 'Bimbingan Konseling', time: '12.45-13.30' },
                { id: 4, subject: 'Geografi', time: '13.30-15.00' },
            ],
            Selasa: [
                { id: 5, subject: 'Bahasa Sunda', time: '06.30-08.00' },
                { id: 6, subject: 'PJOK', time: '08.00-09.30' },
                { id: 7, subject: 'Sejarah', time: '09.45-11.15' },
                { id: 8, subject: 'Bimbingan Konseling', time: '11.15-12.00' },
                { id: 9, subject: 'Bahasa Inggris', time: '12.45-15.00' },
            ],
            Rabu: [
                { id: 10, subject: 'PPKN', time: '06.30-08.00' },
                { id: 11, subject: 'Informatika', time: '08.00-09.30' },
                { id: 12, subject: 'Fisika', time: '09.45-12.00' },
                { id: 13, subject: 'Geografi', time: '12.45 - 15.00' },
            ],
            Kamis: [
                { id: 14, subject: 'Fisika', time: '06.30-08.00' },
                { id: 15, subject: 'Pendidikan Agama Islam', time: '08.00-09.30' },
                { id: 16, subject: 'Biologi', time: '09.45-12.00' },
                { id: 17, subject: 'Matematika', time: '12.45-15.00' },
            ],
            Jumat: [
                { id: 18, subject: 'PKWU', time: '07.10-08.30' },
                { id: 19, subject: 'Seni Budaya', time: '08.30-10.05' },
                { id: 20, subject: 'Biologi', time: '10.05-11.25' },
            ]
        };

        let picketSchedule = {
            Senin: ['Nabil', 'Malia', 'Sultan', 'Nasya', 'Naya', 'Hasna', 'Kintan', 'Nadia'],
            Selasa: ['Farhan', 'Chairil', 'Syakilla', 'Zahra', 'Aldebaran', 'Aulia', 'Heni'],
            Rabu: ['Luna', 'Resti', 'Denian', 'Raka', 'Syafira', 'Fajri', 'Ridhan'],
            Kamis: ['Naisya', 'Puspita', 'Rizqy', 'Maya', 'Anzilah', 'Ghaisan', 'Rafa'],
            Jumat: ['Putri', 'Fadhillah', 'Syifa', 'Daiva', 'Keisha', 'Ayya', 'Iyan']
        };

        let notifications = [
            { id: 1, target: 'all', message: 'Selamat datang di aplikasi Class Info D!' },
            { id: 2, target: 'Nabil', message: 'Jangan lupa tugas Bahasa Indonesia dikumpulkan besok.'}
        ];
        
        let loggedInUser = null;

        // --- DOM ELEMENTS ---
        const initialView = document.getElementById('initial-view');
        const userLoginSection = document.getElementById('user-login-section');
        const adminLoginSection = document.getElementById('admin-login-section');
        const userDashboard = document.getElementById('user-dashboard');
        const adminDashboard = document.getElementById('admin-dashboard');

        // --- RENDER FUNCTIONS ---
        const views = [initialView, userLoginSection, adminLoginSection, userDashboard, adminDashboard];
        
        function showView(viewToShow) {
            views.forEach(view => {
                if (view === viewToShow) {
                    view.classList.remove('hidden');
                } else {
                    view.classList.add('hidden');
                }
            });
        }
        
        function setBackground(type) {
             document.body.classList.remove('login-bg', 'dashboard-bg'); // Clear previous
             document.body.classList.add(type + '-bg'); // Add new
        }

        window.showInitialView = function() {
            setBackground('login');
            showView(initialView);
        }

        window.showLoginView = function(type) {
            // Keep the same login background for both user/admin login screens
            setBackground('login'); 
            if (type === 'user') {
                showView(userLoginSection);
            } else {
                showView(adminLoginSection);
            }
        }

        function renderUserDashboard() {
            document.getElementById('user-welcome').textContent = `Hai ${loggedInUser}, semangat belajarnya!`;

            // Render Class Schedule
            const classContainer = document.getElementById('user-class-schedule');
            classContainer.innerHTML = '';
            for (const day in classSchedule) {
                const dayCard = document.createElement('div');
                dayCard.className = 'bg-bg-medium bg-opacity-80 p-4 rounded-lg shadow-md';
                let lessonsHTML = `<h4 class="font-bold text-lg mb-2 text-accent-red">${day}</h4><ul class="space-y-1 text-sm">`;
                classSchedule[day].forEach(lesson => {
                    lessonsHTML += `<li class="text-text-dark"><span class="font-semibold">${lesson.subject}</span><br><span class="text-gray-600">${lesson.time}</span></li>`;
                });
                lessonsHTML += '</ul>';
                dayCard.innerHTML = lessonsHTML;
                classContainer.appendChild(dayCard);
            }

            // Render Picket Schedule
            const picketContainer = document.getElementById('user-picket-schedule');
            picketContainer.innerHTML = '<p class="text-gray-600">Kamu tidak punya jadwal piket hari ini!</p>';
            for (const day in picketSchedule) {
                if (picketSchedule[day].includes(loggedInUser)) {
                    let picketHTML = `<h4 class="font-bold text-lg text-accent-red">${day}</h4><ul class="list-disc list-inside mt-2">`;
                    picketSchedule[day].forEach(name => {
                        picketHTML += `<li class="${name === loggedInUser ? 'font-bold text-accent-red' : 'text-text-dark'}">${name}</li>`;
                    });
                    picketHTML += '</ul>';
                    picketContainer.innerHTML = picketHTML;
                    break;
                }
            }

            // Render Notifications
            const notifContainer = document.getElementById('user-notifications');
            const userNotifs = notifications.filter(n => n.target === 'all' || n.target === loggedInUser);
            if (userNotifs.length > 0) {
                 notifContainer.innerHTML = '';
                 userNotifs.slice().reverse().forEach(n => { // Tampilkan yg terbaru dulu
                    const notifEl = document.createElement('div');
                    notifEl.className = 'bg-accent-pink bg-opacity-40 p-3 rounded-lg text-sm text-text-dark';
                    notifEl.innerHTML = `<p>${n.message}</p><span class="text-xs text-gray-700">Untuk: ${n.target === 'all' ? 'Semua' : n.target}</span>`;
                    notifContainer.appendChild(notifEl);
                 });
            } else {
                 notifContainer.innerHTML = '<p class="text-gray-600 text-sm">Tidak ada pengumuman baru.</p>';
            }
        }

        function renderAdminDashboard() {
            renderAdminClassSchedule();
            renderAdminPicketSchedule();
            renderNotificationManager();
        }

        function renderAdminClassSchedule() {
            const container = document.getElementById('admin-class-schedule-list');
            container.innerHTML = '';
            for (const day in classSchedule) {
                const dayGroup = document.createElement('div');
                let lessonsHTML = `<h4 class="font-bold text-lg text-accent-red">${day}</h4>`;
                classSchedule[day].forEach((lesson, index) => {
                    lessonsHTML += `
                        <div class="flex justify-between items-center bg-bg-medium p-2 rounded-md mt-1 shadow-sm">
                            <div>
                                <p class="font-semibold text-text-dark">${lesson.subject}</p>
                                <p class="text-sm text-gray-600">${lesson.time}</p>
                            </div>
                            <button onclick="deleteLesson('${day}', ${index})" class="text-red-500 hover:text-red-400 text-xs">Hapus</button>
                        </div>
                    `;
                });
                dayGroup.innerHTML = lessonsHTML;
                container.appendChild(dayGroup);
            }
        }

        function renderAdminPicketSchedule() {
            const container = document.getElementById('admin-picket-schedule-list');
            container.innerHTML = '';
             for (const day in picketSchedule) {
                const dayGroup = document.createElement('div');
                let picketsHTML = `<h4 class="font-bold text-lg text-accent-red">${day}</h4>`;
                picketSchedule[day].forEach((name, index) => {
                    picketsHTML += `
                        <div class="flex justify-between items-center bg-bg-medium p-2 rounded-md mt-1 shadow-sm">
                            <p class="font-semibold text-text-dark">${name}</p>
                            <button onclick="deletePicket('${day}', ${index})" class="text-red-500 hover:text-red-400 text-xs">Hapus</button>
                        </div>
                    `;
                });
                dayGroup.innerHTML = picketsHTML;
                container.appendChild(dayGroup);
            }
        }
        
        function renderNotificationManager() {
            const targetSelect = document.getElementById('notification-target');
            const currentVal = targetSelect.value;
            targetSelect.innerHTML = '<option value="all">Semua Murid</option>';
            Object.keys(users).forEach(username => {
                targetSelect.innerHTML += `<option value="${username}">${username}</option>`;
            });
            targetSelect.value = currentVal;
            
            const historyContainer = document.getElementById('notification-history');
            historyContainer.innerHTML = '';
            notifications.slice().reverse().forEach(n => {
                const historyEl = document.createElement('div');
                historyEl.className = 'bg-bg-medium p-2 rounded-md flex justify-between items-center shadow-sm';
                historyEl.innerHTML = `
                    <div>
                        <p class="text-sm text-text-dark">${n.message}</p>
                        <p class="text-xs text-gray-600">Target: ${n.target}</p>
                    </div>
                    <button onclick="deleteNotification(${n.id})" class="text-red-500 hover:text-red-400 text-xs">Hapus</button>
                `;
                historyContainer.appendChild(historyEl);
            });
        }
        
        // --- EVENT HANDLERS & LOGIC ---

        document.getElementById('user-login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('user-username').value;
            const password = document.getElementById('user-password').value;
            const errorEl = document.getElementById('user-login-error');

            if (users[username] && users[username] === password) {
                loggedInUser = username;
                errorEl.classList.add('hidden');
                setBackground('dashboard');
                showView(userDashboard);
                renderUserDashboard();
            } else {
                errorEl.textContent = 'Nama Panggilan atau Kata Sandi salah.';
                errorEl.classList.remove('hidden');
            }
        });

        document.getElementById('admin-login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            const errorEl = document.getElementById('admin-login-error');

            if (username === 'admin' && password === 'admin123') {
                loggedInUser = 'admin';
                errorEl.classList.add('hidden');
                setBackground('dashboard');
                showView(adminDashboard);
                renderAdminDashboard();
            } else {
                errorEl.textContent = 'Nama Pengelola atau Kata Sandi salah.';
                errorEl.classList.remove('hidden');
            }
        });
        
        function logout() {
            loggedInUser = null;
            document.getElementById('user-login-form').reset();
            document.getElementById('admin-login-form').reset();
            document.getElementById('user-login-error').classList.add('hidden');
            document.getElementById('admin-login-error').classList.add('hidden');
            showInitialView();
        }

        document.getElementById('user-logout-btn').addEventListener('click', logout);
        document.getElementById('admin-logout-btn').addEventListener('click', logout);
        
        document.getElementById('add-lesson-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const day = document.getElementById('add-lesson-day').value;
            const name = document.getElementById('add-lesson-name').value;
            const time = document.getElementById('add-lesson-time').value;
            classSchedule[day].push({ id: Date.now(), subject: name, time: time }); // Tambah id unik
            renderAdminClassSchedule();
            this.reset();
        });

        window.deleteLesson = function(day, index) {
            classSchedule[day].splice(index, 1);
            renderAdminClassSchedule();
        }
        
        document.getElementById('add-picket-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const day = document.getElementById('add-picket-day').value;
            const name = document.getElementById('add-picket-name').value;
            // Tambahkan user baru jika belum ada
            if (users[name] === undefined) { 
                users[name] = 'user123';
            }
            picketSchedule[day].push(name);
            renderAdminPicketSchedule();
            renderNotificationManager(); // Update daftar target notifikasi
            this.reset();
        });

        window.deletePicket = function(day, index) {
            picketSchedule[day].splice(index, 1);
            renderAdminPicketSchedule();
        }

        document.getElementById('send-notification-form').addEventListener('submit', function(e){
            e.preventDefault();
            const target = document.getElementById('notification-target').value;
            const message = document.getElementById('notification-message').value;
            notifications.push({ id: Date.now(), target, message });
            renderNotificationManager();
            this.reset();
        });
        
        window.deleteNotification = function(id) {
            notifications = notifications.filter(n => n.id !== id);
            renderNotificationManager();
        }

        // --- INITIALIZATION ---
        showInitialView();

    </script>
</body>
</html>
